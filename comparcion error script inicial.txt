IF OBJECT_ID ('brog.Viaje', 'U') IS NOT NULL  
   DROP TABLE brog.Viaje; 
GO
CREATE TABLE [brog].[Viaje] (
  [viaj_id] int identity(1,1),
  [viaj_fecha_inicio] datetime2(7) NOT NULL,
  [viaj_fecha_fin] datetime2(3) NOT NULL,
  [viaj_consumo_combustible] decimal(18,2) NOT NULL,
  [viaj_camion] int NOT NULL,
  [viaj_chof] int NOT NULL,
  [viaj_recorrido] int NOT NULL,
  CONSTRAINT PK_Viaje PRIMARY KEY ([viaj_id])
)


NUESTRO
CREATE TABLE [GRAN_EXCEL].[Viajes] (
	[id_viaje] INT IDENTITY(1,1),
	[id_camion_designado] INT NOT NULL,
	[legajo_chofer_designado] INT NOT NULL,
	[id_recorrido] INT NOT NULL,
	[fecha_inicio] DATETIME2(3),
	[fecha_fin] DATETIME2(3),
	[consumo_combustible] DECIMAL(18,2) NOT NULL,	
	PRIMARY KEY(id_viaje)
)
ALTER TABLE [GRAN_EXCEL].[Viajes] ADD CONSTRAINT viajes_id_camion_designado FOREIGN KEY (id_camion_designado) REFERENCES [GRAN_EXCEL].[Camiones](id_camion)
ALTER TABLE [GRAN_EXCEL].[Viajes] ADD CONSTRAINT viajes_id_chofer_designado FOREIGN KEY (legajo_chofer_designado) REFERENCES [GRAN_EXCEL].[Choferes](nro_legajo)
ALTER TABLE [GRAN_EXCEL].[Viajes] ADD CONSTRAINT viajes_id_recorrido FOREIGN KEY (id_recorrido) REFERENCES [GRAN_EXCEL].[Recorridos](id_recorrido)

------------------------------------------------

NUESTRO
CREATE PROCEDURE [GRAN_EXCEL].[sp_carga_paquetes_x_viaje]
AS
    INSERT INTO [GRAN_EXCEL].[PaquetesXViajes](cantidad, id_tipo_paquete, id_viaje)
	SELECT SUM(m.[PAQUETE_CANTIDAD]), t.id_tipo, v.id_viaje
	FROM [gd_esquema].[Maestra] m
	join [GRAN_EXCEL].[Camiones] cam on m.[CAMION_PATENTE] = cam.patente
	join [GRAN_EXCEL].[Viajes] v on (v.fecha_inicio = m.[VIAJE_FECHA_INICIO] and v.fecha_fin = m.[VIAJE_FECHA_FIN] and cam.id_camion = v.id_camion_designado and v.legajo_chofer_designado = m.[CHOFER_NRO_LEGAJO])
	join [GRAN_EXCEL].[Tipos_paquetes] t on t.descripcion = m.[PAQUETE_DESCRIPCION]
	WHERE m.[PAQUETE_CANTIDAD] IS NOT NULL
	GROUP BY t.id_tipo, v.id_viaje
GO

-- MIGRACION PAQUETE X VIAJE


IF OBJECT_ID ('brog.migracionPaquetexviaje', 'P') IS NOT NULL  
   DROP PROCEDURE brog.migracionPaquetexviaje; 
GO






create procedure brog.migracionPaquetexviaje
as
begin
	insert into brog.Paquetexviaje
	select viaj_id, tipa_id, sum(PAQUETE_CANTIDAD)
	from gd_esquema.Maestra 
	join brog.Camion on CAMION_PATENTE = cami_patente
	join brog.Viaje on (VIAJE_FECHA_INICIO = viaj_fecha_inicio and VIAJE_FECHA_FIN = viaj_fecha_fin and viaj_camion = cami_id and CHOFER_NRO_LEGAJO = viaj_chof)
	join brog.Tipo_paquete on PAQUETE_DESCRIPCION = tipa_descripcion
	group by viaj_id, tipa_id, tipa_descripcion
	order by viaj_id, tipa_id
end
GO




NUESTRO
CREATE PROCEDURE [GRAN_EXCEL].[sp_carga_viajes]
AS
    INSERT INTO [GRAN_EXCEL].[Viajes](fecha_inicio, fecha_fin, consumo_combustible, id_camion_designado, legajo_chofer_designado, id_recorrido)
	SELECT m.[VIAJE_FECHA_INICIO], m.[VIAJE_FECHA_FIN], m.[VIAJE_CONSUMO_COMBUSTIBLE], cam.id_camion, cho.nro_legajo, r.id_recorrido
	FROM [gd_esquema].[Maestra] m, [GRAN_EXCEL].[Camiones] cam, [GRAN_EXCEL].[Choferes] cho, [GRAN_EXCEL].[Recorridos] r, [GRAN_EXCEL].[Ciudades] c, [GRAN_EXCEL].[Ciudades] c2
	WHERE m.[VIAJE_FECHA_INICIO] IS NOT NULL
	AND m.[VIAJE_FECHA_FIN] IS NOT NULL
	AND m.[VIAJE_CONSUMO_COMBUSTIBLE] IS NOT NULL
	AND cam.patente = m.[CAMION_PATENTE]
	AND cho.nro_legajo = m.[CHOFER_NRO_LEGAJO]
	AND c.nombre = m.[RECORRIDO_CIUDAD_ORIGEN]
	AND c2.nombre = m.[RECORRIDO_CIUDAD_DESTINO]
	AND r.km = m.[RECORRIDO_KM]
	AND r.precio = m.[RECORRIDO_PRECIO]
GO




-- MIGRACION VIAJE

IF OBJECT_ID ('brog.migracionViaje', 'P') IS NOT NULL  
   DROP PROCEDURE brog.migracionViaje; 
GO

create procedure brog.migracionViaje
as
begin
	insert into brog.Viaje
	select distinct VIAJE_FECHA_INICIO,VIAJE_FECHA_FIN,VIAJE_CONSUMO_COMBUSTIBLE, cami_id, CHOFER_NRO_LEGAJO, reco_id 
	from gd_esquema.Maestra
	join brog.Camion on CAMION_PATENTE = cami_patente
	join brog.Recorrido on (RECORRIDO_CIUDAD_DESTINO = reco_ciudad_dest and RECORRIDO_CIUDAD_ORIGEN = reco_ciudad_origen ) -- puse todos xq es posible que se repitan y matchee con cualquiera)
	where VIAJE_FECHA_INICIO IS NOT NULL 
	order by CHOFER_NRO_LEGAJO desc, VIAJE_FECHA_INICIO desc
end
GO



RESULTADOS:
viaje no supera los 35 mil
paquetexviaje no mas de 420 mil